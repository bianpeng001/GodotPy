import os
import os.path
import shutil

Import('env')
Import("env_modules")

print('init GodotPy...')

PYTHON_HOME = 'D:/OpenSource/cpython'
if not os.path.exists(PYTHON_HOME):
    PYTHON_HOME = 'H:/cpython'

# 准备工作
def GetReady():
    GodotPyLib = PYTHON_HOME + '/GodotPy.lib'
    DstName = PYTHON_HOME + '/GodotPy' + env["LIBSUFFIX"]
    if os.path.exists(GodotPyLib) and not os.path.exists(DstName):
        print('copy GodotPy.lib')
        shutil.copyfile(GodotPyLib, DstName)


GetReady()

env.Append(LIBPATH = [
    PYTHON_HOME,
])
env.Append(LIBS = [
    'GodotPy',
])

godotpy_module = env_modules.Clone()
godotpy_module.Append(CPPPATH = [
    PYTHON_HOME + '/Include',
    PYTHON_HOME + '/Include/internal',
    PYTHON_HOME + '/Godot',
])
godotpy_module.add_source_files(env.modules_sources, "src/*.cpp")


#
# build_windows.bat
# bin\godot.windows.editor.dev.x86_64.console.exe --path h:\GodotPy\Demo -e -w
#
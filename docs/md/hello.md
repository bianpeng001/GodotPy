[TOC]

# 洒家的博客

<!--

## 开发日志
<div class="date">xxxx年x月xx日</div>

-->

## 开发日志

1. 继续做玩法, 攻城略地. 其实粗略的攻城已经有了, 但是还没有战法.
2. 武将技能, 需要做一些相关的特效. 火焰, 落雷, 烟雾, 落石什么的, 可以做的挺多的. 合战攻城都有技能特效.
3. 框选群体指令继续. 选中已经ok了, 目前用一个简单的方式做入框的判断, 后面再优化吧. 
4. 只允许选中自己的单位进行操作. 别人的就不出指令即可.
5. 选中不同类型单位, 如何处理? 他们支持不同的指令. 这样的话, 各个指令所在的格子, 是不是就要冲突了? 我现在留了8个指令的格子.
6. 最多选中9个单位, 好伤感. 再多的话, 格子就有点放不下了啊. 要么支持一下, 可以缩放?
7. 改进了一下boot.py里面接管的输出,用StringIO来实现, 优美一些, 就像StringBuilder了.
8. 水战? 这个后面再说吧, 现在的河不够宽. 体现不出天堑的意思来. 至少要接近一屏的宽度, 才有赤壁大战的感觉.
9. 所以,300x300的地图,不够用了,这个反正对我来说就是个数字,后面有空改成1000*1000试试.
10. 另外, 太湖在长江以南. 这个要纠正一下, 我一直以为太湖很远, 原来离老家这么近的. 
11. 鄱阳湖大战, 如果不够两屏, 好意思叫鄱阳湖大战吗?

UE 技能
1. console command: 简单的实现方式, UFUNCTION(Exec)标记的方法. 法详见文档. 以下查找顺序:
APawn,APlayerController,UPlayerInput,UCheatManager,AGameMode,UGameInstance,AHUD

<div class="date">2023年5月9日</div>

1. 继续框选单位, 群体指令. 
2. 尝试用了一下真实的地图的截图, 想把uv映射的更加精细一些. 原先是一个六边形, 用一个uv, 改进下, 按照位置去算UV, 这样就能平滑的显示地图了. 效果不太好, 可能是计算有误, 或者就是精度还是不够. 暂时还不好用

<div class="date">2023年5月8日</div>

1. 框选, 群体指令, 有没有必要! 这样就看起来有点像星际了. 管他呢, 先做了吧. 感觉有的时候一个个点击操作, 真实令人烦恼. 但是, 框选跟现在的默认拖拽地图, 有点冲突. 如何照顾两个操作.
2. 左键画框, 右键拖动. 也是合理的, 3d设计软件有不少是这么做的. 这个改造了一下, 实现起来挺容易的.
3. 画框的方案
   1. 用Node2D的_draw机制, 详见[Custom drawing in 2D](https://docs.godotengine.org/en/stable/tutorials/2d/custom_drawing_in_2d.html). 接口我加了, 但是不想用, 看起来是构造图元的方式, 来实现矢量绘制接口. 效率还是不太高的.
   2. 用UI的方块缩放. 这个比较适合这个使用场合, 比较难受的是UI上面, 我开始做的是在UI上面不能拖动, 所以, 需要把选择框的尺寸控制一下, 方块的边缘空出来.
4. 然后, 越来越像星际了, 容我三思. 但是, 原先的右键菜单的操作方式, 总归是太丑陋了.


辛弃疾,陆游的诗,可以多来几首,十分契合
>永遇乐·京口北固亭怀古<br/>
千古江山，英雄无觅，孙仲谋处。舞榭歌台，风流总被，雨打风吹去。斜阳草树，寻常巷陌，人道寄奴曾住。想当年，金戈铁马，气吞万里如虎。<br/>
元嘉草草，封狼居胥，赢得仓皇北顾。四十三年，望中犹记，烽火扬州路。可堪回首，佛狸祠下，一片神鸦社鼓。凭谁问，廉颇老矣，尚能饭否？<br/>

>破阵子·为陈同甫赋壮词以寄<br/>
醉里挑灯看剑，梦回吹角连营。八百里分麾下炙，五十弦翻塞外声。沙场秋点兵。<br/>
马作的卢飞快，弓如霹雳弦惊。了却君王天下事，赢得生前身后名。可怜白发生！<br/>

>将止酒，戒酒杯使勿近<br/>
杯汝来前！老子今朝，点检形骸。甚长年抱渴，咽如焦釜；于今喜睡，气似奔雷。汝说“刘伶，古今达者，醉后何妨死便埋”。浑如此，叹汝于知己，真少恩哉！<br/>
更凭歌舞为媒。算合作人间鸩毒猜。况怨无小大，生于所爱；物无美恶，过则为灾。与汝成言，勿留亟退，吾力犹能肆汝杯。杯再拜，道“麾之即去，招则须来。”<br/>

<div class="date">2023年5月6日</div>

对军队的AI代码做了一些重构, 组件方式来组织功能和数据.

指令面板,显示出来了, 以后用指令面板的按钮来操作目标单位. 
其实我不太想用快捷键, 因为太累了. 所谓指点江山, 就是一个指头就够了的啊.

<div class="date">2023年5月5日</div>

做战役讲解, 需要包含几个元素
1. 地图
2. 城市
3. 军队
4. 路线
5. 编辑器, 包括地图,武将等的灵活定制

其他:
1. 武将要分男女
2. 单位要有护甲, 对城来说, 就是城防. 有一部分伤害, 要扣护甲上.
3. 右键菜单, 改到命令面板

<div class="date">2023年5月4日</div>

1. 调整避让的参数, 让转弯更加柔和
2. 减少碰撞遍历的单位数量, 根据相对位置来判断是否要处理相邻地块

如果避让多次没有停下来, 则需要停在原地. 这个可以留着, 以后再处理, 主要还没有想好怎么停下来, 停下来以后的行为.

队伍内的单位, 互相不做碰撞, 用组件精确控制各个单位的位置, 队内天网自动导航. 对外用碰撞互斥来做分散.

还要加一个附加质量, 防止来回弹. 让密集的区域, 往稀疏的方向扩散.

队伍的行军避让规则完成, StepMoveComponent效果感觉可以了. 所以做一个优化的版本NewtonMoveComponent, 作为正式使用.
功能一样, 局部做一些微调, 以及更少的内存开销. 跑了一个10个队伍的, 看到了预期中的大漩涡.
各个队伍转向, 移动, 看得到一些灵气, 区别于之前的呆滞生硬.

stable diffusion
- [stable diffusion](https://github.com/AUTOMATIC1111/stable-diffusion-webui)
- [生成法线](https://cpetry.github.io/NormalMap-Online)

<div class="date">2023年4月26日</div>

## 战役解说员

想起来, 在做这个东西之前, 在B站上观看了几个视频, 讲解夷陵之战, 抗美援朝的几次战斗, 对着地图讲解, 全程激动的看完了. 

如果能用我正在做的这个游戏, 把战役的过程, 表现出来, 岂不美哉?


1. 修正走路阻挡的参数调整
2. 统一创建player的流程, 主玩家和机器人玩家, 都是从同一个方法
3. 把AI从城市头上, 转移到player头上

<div class="date">2023年4月25日</div>

## 开发日志

1. 基于effect做伤害飘字. ok
2. ai玩家, 拥有几个城的诸侯(player).

加一个地图的特征, 资源不能无缘无故的共享, 需要走运输队, 粮车. 在地图上, 城池间运输, 并且有损耗, 会被打劫.
所以, 古代演义小说, 有两个重要位置, 先锋官和运粮官, 都是比较猛的人担任的. 牛皋, 程咬金啥的.

行军的路径, 需要加一个自定义路点的, 有一些科学的路径, 需要体现一下玩家的策略. 毕竟这是一个策略游戏.

<div class="date">2023年4月24日</div>

## 野战攻城

地图的改进
1. 是得到一批模型, 但要用起来还比较难的, 先放一个未来场景, 等完善后再替换进去. 原本就是一个个方块.
2. 用一个300x300的大图,描述图元,方块内部是六边形, 直接用颜色来采样, 视觉上就丰富了.

地图上面军队的避让, 目前做的这个避让效果是有了, 但是朝向不连续, 导致走起来不连贯. 后面把单个士兵的追击效果改好, 不断调整阵型, 这样穿帮就少了.

<div class="date">2023年4月23日</div>

## AI玩家和剧本

想要玩起来, 还要一堆智商适中的AI玩家. 总体跟着剧本, 但是也要表现出一些攻击性, 策略性来. 

所以, 需要创建一些AI玩家. 上来, 就得有几个诸侯, 控制几个城池. 这些势力对外扩张. 城市则有郡和县的区别, 且有不同的经济情况.

然后, 为了让这些数字的战斗代入感情, 得有个剧本. 历史上这样的剧本还是不少的
- 秦末起义,楚汉相争
- 东汉末年
- 五胡乱华
- 隋唐英雄
- 五代十国
- 元末农民起义
- 万历援朝
- 明末困局
- 拿破仑战争
- 日本战国
- 美国独立战争

<div class="date">2023年4月21日</div>

## 美丽的六边形

实践表明, 地图只要用方块就可以很好的玩起来了. 但是在地形的拼接过渡上面, 方块对美术要求还是要一些的. 参见星际1,魔兽3. 

为了降低难度, 我只好把之前懒得做的六边形, 又加上了. 果然毫无区别.

![screenshot07](img/screenshot07.png)

江河湖海的边界, 确实是好看了一些的.

为了减少地图延迟加载的一帧里面, 屏幕中的空隙处, 漏出来的底色. 可能有点突兀. 我把底色改成绿的, 跟绿地一致. 对眼睛的刺激就柔和多了.

描边方案, 是需要用深度图的, 目前这个参数, 要求terrain的深度图不要写入, 不然边界不够清晰. 所以地面的深度写入关闭, 这样就要求地面的渲染要最早进行. 所以需要调整优先级, 材质上面的render priority:= -50.

<div class="date">2023年4月19日</div>

## 特点

我的卧龙凤雏队友, 看了眼游戏视频, 曰, 一般般, 没啥特色. 不禁令我心虚. 到目前为止, 一直在想抄这个抄那个, 确实还没想过特色. 痛定思痛思索两天, 暂时也没想到啥有趣的点子. 自我安慰一下, 船到桥头自然直, 特点会有的, 毕竟每一个游戏都带着开发者自身的特点, 比如建模特别丑, 审美特别残暴, 以及特别偏执.

把旗帜改善了一下. 把原本的直面摆动, 改成了曲面波浪, 效果好了不少的. 队伍的行军的旗帜, 不够气派, 作为一个有品位的人, 参见孙悟空大闹天宫的红披风, 越长越好. 如果能开上物理布料啥的就更好了, 不过有可能物理的效果未必如人意, 先这样也挺好了.

![screenshot06](img/screenshot06.png)

射箭的粒子特效, 仔细学习了一下, 改进了一下弓箭的频率, 飞行过程的朝向. 仅靠抛物线和转圈的基本元素, 做出来那么多华丽的效果, 不由感叹特效组同事们的创造力.

阵型打乱和调整的时候, 由于士兵是的父子节点关系, 修改上层节点的位置和朝向, 导致子节点也立即跟随. 所以, 需要去掉父子节点关系, 并把位置的同步, 改成追向目标位置的方式.



<div class="date">2023年4月17日</div>

## 行军

队伍的行军, 做了一个尽量简化的rvo, 效果看上去能接受. 有一些物理运算简化掉了, 非线性的斥力增长, 注意需要去掉从0开始的一个跳跃.

目前测试的用例是, 绕过一个静止的队伍, 以及绕过几个静止的队伍. 偶尔会被卡主, 这个后面要改进一下. 

运动过程中的相互避让. 这个现在也有了.

队伍路线基本上雏形有了, 但是士兵的路线就显得有点呆滞了. 实际我想的是, 士兵也要有单独的路线, 当调整阵型, 就是转弯的时候, 朝向立马受影响, 导致阵型要体现受影响, 但是士兵的位置不能突变, 所以需要一个调整阵型的效果. 这就看上去挺鲜活的了.

后续问题

1. 卡位, 走不过去. 一般来说, 卡死超时, 则另外选一个不远的目标点. 或者原地停住. 也许可以用临时的缩小半径, 持续一段时间后恢复, 挤过去试试.
2. 跨界, 跟相邻地块中的单位的rvo.

先在python里面实现, 性能问题不大, 如果实在想再优秀一点, 还有c++保底. 这就是godot的优势之一了, 除了年轻貌美, 还有c++大腿, 先抱python大腿, 也是很香的.

然后是很重要但也很难的一块, 特效!!! 

<div class="date">2023年4月14日</div>

## 战斗(2)

### 城市AI
完善数据接口, 根据资源量, 周围的城池的情况, 派遣攻击队伍

内政AI, 结合在结算点, 安排当前的资源.

### 队伍AI
视野, 感知敌军和城池. 进行攻击.
视觉目前是一个圈, 应该要做成背后没有视觉, 这样就更加好玩一些.


### 城池之间的物资运输
军队进城, 把武将队伍和资源都要带进城去. 路上消灭敌军的时候, 也有资源和部队俘虏的数据.

### 建设
基本上, 种田流是一个不能忽视的群体. 人类天生有种田的天赋, 埋下种子, 浇灌松土, 秋天收获. 虽然不能大富大贵, 但是稳. 
围绕土地, 农民阶级进行了两千年的反抗, 每次都是推翻旧统治的主力军.

要玩的起来, 还是要多一点模型. 目前已经可以放田块了. 

### 其他
可能的话, 想做一条连接城池的公路. 这样看起来会更丰富. 

<div class="date">2023年4月12日</div>

## 战斗

武将取名字还是挺有点东西的, 其实主要就是要符合古人的习惯, 别太妖艳. 我现在做的名字库主要是按照三国时期武将的名字来的, 也会照顾到姓氏的大小. 另外加一些著名人物的名字做补充. 后续会进一步区分男女, 名将. 武将数值, 目前也做了个随机生成, 也够用了, 待细化. 城内武将自动生成10~20人.

接下来重点放到战斗来, 继续攻城略地剿匪.

### 行军细化
1. 转向, 要体现调整阵型时, 单个小兵单位的走位
2. 两支军队的穿插, rvo
3. 绕障碍
4. 不可过区域, 比如渡河, 渡海
5. 地形的影响, 影响速度, 反应, 视野, 中毒
6. 陷阱, 火烧, 毒雾

### 战斗细化
1. 野战, 遭遇战
2. 攻城战
3. 战法表现

<div class="date">2023年4月10日</div>

## 描边

学习了一下屏幕特效, 发现godot的方式挺简陋的. 那个什么, 让我想起了手搓卫星, 再一次的. 话虽如此, 但原理上感觉更透彻了, 不就是屏幕特效么, 就看结果对不对吧, 过程就不要太苛刻了.

![screenshot05](img/screenshot05.png)

挺有感觉的, 效果还不错, 性价比很高. shader的代码也简单, 意味着运算量不大.

深度图采样,差值, 用来确定边界
[深度图采样](https://godotshaders.com/shader/screen-space-edge-detection-outline-shader/)

进阶版本, 深度图采样, 并还原到view空间的线性深度, 比较周围点来确定边界.
[深度图采样+线性解码](https://godotshaders.com/shader/depth-modulated-pixel-outline-in-screen-space/)


至于是什么让我感觉到简陋, 需要用到提供一个2x2的quad, 并且跳过MVP矩阵变换. 直接把几何坐标当做投影坐标. 但是那个quad的可见性, 和render order, 还是要人工来控制的, 不然等镜头移走, 这里就突然没有特效了.

<div class="date">2023年4月6日</div>

## 九宫八卦河图洛书

太极这个思想, 是中国先民所独有的, 人们朴素的对这个世界的理解. 在那个荒蛮的年代, 这门学问可就是高科技了, 哪怕后世的几千年, 被认为是通天彻地的技能. 先民感悟太极的时候, 甚至连老君玉皇这些神祇都还没有出现. 可以想象一下, 第一个看到太极图, 八卦图, 九宫格的人, 他的眼睛里是闪耀着什么样的智慧光芒. 具体什么叫通天彻地, 我觉得差不多就是牛顿在纸上写下万有引力公式, 用来解释天体运动那种感觉. 

伏羲先天八卦图

||||
|-|-|-|
|☱兑|☰乾|☴巽|
|☲离|![太极](img/Tj.png)|☵坎|
|☳震|☷坤|☶艮|


文王后天八卦

||||
|-|-|-|
|☴巽|☲离|☷坤|
|☳震|![太极](img/Tj.png)|☱兑|
|☶艮|☵坎|☰乾|

对应到方位

||||
|-|-|-|
|东南|南|西南|
|东|中|西|
|东北|北|西北|

对应到九州

||||
|-|-|-|
|扬|荆|益|
|青|徐|豫|
|兖|冀|雍|

这里按照古代看地图, 坐北朝南的视角看的, 所以上下左右跟现在的地图习惯翻一下. 记住西北乾天, 就记住了方位.

九州, 把天下按照九宫八卦格划分一下. 落在哪里就哪里, 不是很规整, 但大致这么区分就行.

<div class="date">2023年4月4日</div>

## 捏脸

是的, 你没有看错, 就是那个庸俗的捏脸系统. 我可以穷, 但不能没有追求. 有钱有有钱的玩法, 没钱有没钱的玩法. 看我以前辈们手撸卫星的勇气, 高低整一个3D捏脸系统出来.

主要是, 我觉得, 这种武将的游戏, 看不到脸, 只有一个抽象的名字, 和一堆数字. 本来就够抽象了, 尽量给点脸色看看, 丑点就丑点吧.

对比
||手绘|捏脸|
|-|-|-|
|效果|美|丑|
|成本|持续增长|一次性投入|
|产量|低,手撸|高,自动|
|存储|量大|小|
|门槛|手绘技能|拼拼凑凑|

方案二: 提供点阵, 自己绘制. 这个也不显示, 也是需要工作量的, 而且是点阵像素画, 其实对艺术要求也很高.

捏脸还可以分2d捏脸和3d捏脸. 我感觉2d捏脸会是一个兼顾美丽和效率的方案. 奈何, 2d也是要画的, 还是丑陋的3d吧. 毕竟3d丑陋不是罪. 强行手绘的话, 哪怕只有几个部件, 也只能体现我的手残.

制作过程里的一些经验
1. 用LowPoly, 加上调色板来实现. 而不是顶点色, 主要是编辑不方便
2. 几个部件分开, 头, 眼睛, 眉毛, 嘴巴, 胡子, 帽子, 发型. 有一些部件需要用透明通道

小技巧: 
blender使用透明材质, 需要连接alpha通道, Shading模式下编辑, principled bsdf, 可视化的材质编辑. 
Blend Mode: Alpha Blend, Alpha来源, 设置成 Channel Packed


<div class="date">2023年4月3日</div>

## _socket 模块

顺手把socketmodule加上了, 发现编译进python3.dll则增加40kb, 单独编译成_socket.pyd, 则有200kb. 说明还是有不少代码静态链接进去了. 

如果将来需要往其他平台port, 我觉得还是静态编译好一些, 直接一个单独的python3.dll. 不过,需要应该要改一下config.c, 新增一项, "_socket".

>其疾如风，其徐如林，侵掠如火，不动如山，难知如阴，动如雷震。掠乡分众，廓地分利，悬权而动。

<div class="date">2023年3月31日</div>

## 玩法笔记(4)

继续主线和存档, 主线需要一个事件生成器. 一些大事件按照配置走, 随机事件的产生. 用来生成一些任务, 主要是提供一些收益. 比如盗贼, 经商等.

存档, sqlitedb, 以及配合json. 应该绰绰有余. sqlite的好处是, 方便查看.

从英雄说起

>龙能大能小，能升能隐；大则兴云吐雾，小则隐介藏形；升则飞腾于宇宙之间，隐则潜伏于波涛之内。
>方今春深，龙乘时变化，犹人得志而纵横四海。龙之为物，可比世之英雄。玄德久历四方，必知当世英雄。请试指言之。

- 淮南袁术 -> 冢中枯骨
- 河北袁绍 -> 好谋无断
- 八俊刘景升 -> 虚名无实
- 益州刘季玉 -> 守户之犬
- 张绣、张鲁、韩遂 -> 碌碌小人

>夫英雄者，胸怀大志，腹有良谋，有包藏宇宙之机，吞吐天地之志者也。
>操以手指玄德，后自指，曰：“今天下英雄，惟使君与操耳！”

这段读起来拍案叫绝, 令人神往. 不得不感慨, 这英雄的门槛也太高了. 这几位落选者, 本也是人中龙凤, 在这里却是虫豸而已. 韩信落难后, 曾过樊哙家, 樊哙对他十分尊敬, 韩信自嘲:"生乃与哙等为伍". 

这些人, 至少有一个称号, 豪杰. 
说起豪杰, 那就广泛多了. 对应于各行各业, 掌握了一点技能, 并在行业中内卷到佼佼者. 
比如普通人能挑100斤, 你能挑200斤, 此之谓豪杰; 别人高考500分, 你考了600分, 豪杰, 700分, 豪杰中的豪杰. 
简而言之, 英雄, 是最后收割的那几个人; 豪杰, 则是英雄预备队, 无限接近英雄, 最终止步决赛的那群人. 掌握了冠军的实力, 却没有冠军之名, 但要觉得他不能打, 立马教你做人. 
比如著名的冢中枯骨, 袁绍袁术兄弟, 三姓家奴吕布, 北地枪王张绣, 西北军阀马家父子, 五斗米教张家, 荆州八俊刘景升, 江东孙氏父子, 白马义从, 天公将军张角兄弟, 五代枭雄, 前秦苻坚, 鲜卑慕容, 隋唐十八路反王, 元末英烈. 我也曾, 搅动乾坤翻云覆雨, 我也曾, 吞吐天地矫若龙虎, 我也曾, 双手插兜世间没有敌手. 虽然最后因为自身的一些短板, 或者运气太差, 不甘地倒在了命运面前, 或者叫中道崩殂, 与英雄二字失之交臂. 
但在历史的长河里, 留下的身前身后名, 也算是光芒万丈, 令后人扼腕叹息.

天下英雄, 唯使君与操耳. 
魏武汉昭烈, 的确无愧于英雄. 天下豪杰, 则是英雄产生的土壤, 如众星拱月, 最后的英雄从豪杰堆里破土而出. 土壤的品质, 决定了果实的品质. 双脚的高度, 决定了视野的高度.
曹操说, "设使国家无有孤，不知当几人称帝，几人称王！" 也是对这些豪杰们的历史地位的肯定. 
而他自己, 在青年时期并没有想这么多, 后来他回忆如是说: "欲望封侯作征西将军，然后题墓道言 “汉故征西将军曹侯之墓”，此其志也。"
正是有吕布袁绍刘备, 这样的对手, 最后成就了赫赫威名的魏武帝. 
刘秀也是因为昆阳之战, 面对数十倍的敌人, 有了满级陨石召唤术大魔导师的称号.

这些生于乱世, 不甘平凡, 反抗命运, 抛头颅洒热血, 还世界一个太平而努力的人. 我辈读书人, 只有敬佩, 心向往之.

<div class="date">2023年3月30日</div>

## 场景地图

一直想不出太好的方案左右为难, 兼顾好看简单高效. 点兵点将考虑下来, 唯有牺牲一下好看. 毕竟, 就算我绞尽脑汁, 做到自认的好看, 在专业眼中仍旧是一片渣渣. 兵法曰, 有比没有好. 好看什么的后面再追求, 搁置争议优先功能. 须知由俭入奢易, 由奢入俭难. 

截屏留念!

![screenshot02](img/screenshot02.png)

![screenshot03](img/screenshot03.png)

然后把边角用材质修整一下, 看起来不那么锋利, 马马虎虎就算搞好了. 前辈们手搓卫星的那个年代, 条件得比这艰苦吧多了. 只要目标没错, 中间的路径可以宽松一些.

优化了一下下, 把边角处理了一下, 锯齿处理掉一些. 然后继续回来搞主线和存档, 地图以后用常规的方案来做, 做的精细一些. 而不是现在这种残暴的色块. 熟悉地理的就可以认一认, 这是哪里? 

![screenshot04](img/screenshot04.png)


<div class="date">2023年3月27日</div>

## 玩法笔记(3)

身份危机: 终于遇到了一个身份问题?我是谁,我在哪里的问题.
以前在9里面,有一些人也是有这个质疑的. 我是否在武将列表里面,我在的话,我到底是武将还是君主.我若不在,则城内太守是哪个?
9里面的话,是有一个自己的.我觉得放一个自己还好一些. 自己在武将列表里面的话,每个地方都要特殊处理一下. 也挺烦的, 但没有这个自己的话. 有的时候, 任命啥的, 还有自己的数值, 岂不是毫无用处. 毕竟很多君主的数值是真的很牛逼. 况且, 没有这个本体英雄, 如何俘虏对方君主收为己用呢?

[九州](https://zh.wikipedia.org/zh-hant/%E4%B9%9D%E5%B7%9E_(%E4%B8%AD%E5%9B%BD)),还是得要的.

![三国时期的九州](https://upload.wikimedia.org/wikipedia/commons/b/b7/%E4%B8%89%E5%9C%8B%E6%99%82%E6%9C%9F%E8%A1%8C%E6%94%BF%E5%8D%80%E5%8A%83%E5%9C%96.svg)

[三国官制](https://zh.wikipedia.org/wiki/%E4%B8%89%E5%9B%BD%E5%AE%98%E5%88%B6)

曹魏地方官制

- 州: 州牧(刺史). 置治中从事、别驾从事、功曹从事、簿曹从事、兵曹从事、郡国从事、文学从事、武猛从事、督邮、主簿、帐下督、门亭长、书佐、计吏.
- 郡: 太守. 置司马,长史,都尉.
- 县: 县令. 置县丞,县尉.

游戏名字有想法了 
- 豪杰是怎样练成的
- 豪杰科目一

<div class="date">2023年3月24日</div>

## 军队操作

目前给军队加了个上下文菜单, 
- 目标: 修改目标的一个快速操作
- 策略: 修改阵形,目标,策略等
- 撤退: 撤退的快速操作,自动退回本城

处理英雄同时只能做一件事情, 提高人才的重要性
>短歌行<br/>
對酒當歌，人生幾何！<br/>
譬如朝露，去日苦多。<br/>
慨當以慷，憂思難忘。<br/>
何以解憂？唯有杜康。<br/>
青青子衿，悠悠我心。<br/>
但爲君故，沉吟至今。<br/>
呦呦鹿鳴，食野之苹。<br/>
我有嘉賓，鼓瑟吹笙。<br/>
明明如月，何時可掇？<br/>
憂從中來，不可斷絕。<br/>
越陌度阡，枉用相存。<br/>
契闊談宴，心念舊恩。<br/>
月明星稀，烏鵲南飛。<br/>
繞樹三匝，何枝可依？<br/>
山不厭高，海不厭深。<br/>
周公吐哺，天下歸心。<br/>

所以,多招募点英雄吧, 人多了好干活.

>观沧海<br/>
东临碣石，以观沧海。<br/>
水何澹澹，山岛竦峙。<br/>
树木丛生，百草丰茂。<br/>
秋风萧瑟，洪波涌起。<br/>
日月之行，若出其中。<br/>
星汉灿烂，若出其里。<br/>
幸甚至哉，歌以咏志。<br/>

<div class="date">2023年3月22日</div>

## 玩法笔记(2)

内政和战斗继续细化下去.其实当初有一个遗憾,是相对于前面的官员扮演,政治事件发生太少.所以,后面几代的事件就多了不少的. 可能的故事是这样的

在黄巾起义之后,随着军阀实力的提升,地方武装,不论是黄巾还是地主武装,在大势面前,逐步接受现状,要么回家务农,要么参军,要么在地方上担任一官半职,比如安喜县尉.

第一个选择,遣散回乡(游戏结束),任职县尉(得到一个小县),带队投军(得到一个关卡)

这个阶段的特点,就是内政,剿匪,保境,安民. 县城要朴素,小,城墙低矮.
发展到一定程度,督邮前来考核勒索.

第二次选择,交钱妥协(继续发展,魅力大减),鞭打督邮(换个大点的县城,魅力大增).

继续发展, 接下来发生的事件有,参与救援.

...

周围有敌军,则可以进入战斗;没有敌军,则进入资源配送,经商.

后面如果遇到强敌,也会出现一些文案,投靠关系较好的诸侯,然后得到一个小城,继续战斗.
总体而言要体现忠义,体现谋略,有准备的冒险精神; 区别于奸诈背叛,莽夫,束手就擒.


<div class="date">2023年3月19日</div>

## Demo v0.0.7

我感觉这是一个比较稳定的版本了,目前需要编译c++的部分越来越少.估计有一些访问接口, 后面遇到了逐步添加即可.

1. 内政,出战界面基本完工 (这样,两个玩法就有了,内政和出战)
2. 资源增长,做了第一版数值. ( 很粗糙, 略尴尬, 后面还要做一些应用题才行 )
3. 程序接口进一步完善, 资源加载接口ok, 只有一个接口load_resource, 包内资源
4. HUD细化,根据可见复用,不可见的立马回收
5. 地图开始用pcg方式来进行 (build mesh的接口, 接下来, 要把地图弄得多样性一些, 大约就是一些拼接)

TODO:

1. 细化战斗,攻城,场景和地图界面
2. 改善资源,学习美术,这个是长期的追求,不可着急

![screenshot01](img/screenshot01.png)


最近AI风头正劲, 各路豪杰不断的放出自己憋了好久的大招, 一出手就是让人眼花缭乱羡慕不已. 感觉好几个工种, 接下来危险了, 说不定哪一天, 就直接被AI取代了. 这个哪一天, 目测已经不是那么的遥远, 说快也快, 可能就是明天.

所以,还是要好好学一下AI,沾沾光,用一点点AI的好处. 比如, 文案,原画,立绘.

<div class="date">2023年3月17日</div>

## 让地图好看点

做个人吧,做不到真正意义上的好看,但是花点心思收拾一下,哪怕之比原先的地图好看一点点,也算是我的一番努力.

先把地图的细节丰富一下,放点水和草地.

<div class="date">2023年3月13日</div>


## Demo v0.0.6
发一个版本,现在开始,应该逐步强化游戏内容.基础建设已经比较ok了,接下来见招拆招即可.
三国9抄起来,三国10准备抄起来.

内政做得好的话,其实已经够玩了.三国9的内政相对于前几代,其实是大大简化的.就是几个数值,比较单调.
但是他的战斗很好玩,世界大地图上,各种打.水战比较少.节奏快,功利一点,半天时间就能统一.

10的战斗很漂亮,可玩的内容多.但内政元素有点多,所以整体节奏相对于9慢不少.能从青年赵云,打到老年赵云.10的行动力的设计,比较符合现实,9里面是每个人每旬只能做一件事情,10里面是扣减对应的行动力.

<div class="date">2023年3月12日</div>

## 无题

忍了很久,还是忍不住去把HUD的创建和刷新,给重新做了一下复用.包括单位的模型等,后面也得复用.不然也太浪费了. 昨天已经看到瞬间创建一百个队伍的壮观场景,走成一条长龙.密密麻麻的往前冲去.

关于城池资源增长率的公式影响因素,简单点,不用基础增长率了,直接等于0,也省得调.
体现一下,有时候,太守的属性过于低,导致反而不如保底的数值.当数值上来以后,就能做到显著增加了,体现高段位数值的重要性.
先用着,如果有一个人认为这个设计很sb的话,我就认错去掉.

然后计算的原则,就是尽量即时算,浪费点计算量,保证正确性.不然就要加很多事件notification啥的.

以及,城池的英雄列表,还是要根据事件来刷新,不然就是挺丑陋的,容易不同步,也容易出现多刷.

征兵,怎么处理.

<div class="date">2023年3月10日</div>

## 关于UE

UE也很不错,用了一阵,学习曲线遇到了第二个的低谷,又一次感受到了优秀的设计.
1. Object LifeCycle,  TWeakObjectPtr<T>, GC
2. DedicatedServer, 配置方便,蓝图和属性,方法等,都已经支持Replicate. 

接上文,同步这块,上手是容易的,工具设计的也足够方便.但作为游戏开发者,还是要深入看一下实现,对具体流程有一个把握.这时候,障碍就来了. UE分装的比较好的是属性同步,事件广播,RPC也还行. 但还是要求程序对同步机制有深入的了解,至少要看看源码. 属性同步 + 单位创建.

<div class="date">2023年3月8日</div>

## 官军 or 泥腿子

理论上讲,我应该算官军.毕竟在雨田混了好几年,也是奔着学习的心态,学无高下,达者为先.
最后结果是毫无收获,也是挺尴尬.从风头之前,做到风头过去,方案还是没有确定.加上有几个职场智多星,搅得乌烟瘴气.就有点伤了,人财两失.

学到一种开发方式,叫做点菜式.所有菜先点一遍,包括但不限于鲁川粤苏闽浙湘徽,并让几个手下密切关注烹饪节目,发现市场涌现的新菜,随时补充添加,对于做好的菜,随时更新迭代. 至于好还是不好,自行判断,经历过的人都抑郁了.

几年过下来,团队应该把游戏开发中,但凡可能犯的错误,可能踩的坑,都经历过一次以上.这时候,机智的人应该发现了一线生机,只要避开这些坑,岂不就是通向成功的光明大道.硬要说的话,这就是我最大的收获.迅速结束PTSD,投入下一个尝试.

吃过军粮的我们,当起泥腿子子来,应该也是毫无困难的,毕竟谁没当过泥腿子呢.

<div class="date">2023年3月8日</div>

## 无题

代码都是开源的,数据也是明文的.其他的只能祝好运了.
看3d模型的贴图时,无论多好看的模型,看起来都像画皮一样,心中一片平静.
玩游戏变成了解应用题,就无趣了.

年初看满江红,一些人陈词滥调,把岳飞冤死归结为政治低能.感觉这里的政治,就是跟赵构秦桧同流合污的意思,让跪谁就跪谁,让咬谁就咬谁.难以苟同.
所以,这里我简单一些,把政治,按字面意思理解,政务,治理,地方事务的处理能力.

思来想去,还是把图标换了,毕竟图标还是要体现一下内容的.机器人虽然挺可爱,但不还有Python么.Python是巨蟒,跟巨蟒有关的中国题材的话,青龙应该可以.龙之为物,可比世之英雄.正好龙还呼应了Demo的题材,三国嘛.再然后,可能还是机器人盘条龙,会更匹配.体现了godot+python=robot(机器人)+loong(龙).这样的话,不就成了玄武了.

<div class="date">2023年3月7日</div>

## 关于玩法的笔记(1)

基本思路:

1. 做单机游戏,不做网游,因为网游难搞,且各种不方便,开发调试发布等各种方面.
2. 先只做PC,把玩法和系统都稳定出来了,别人能接受的话.再考虑手机,避免多线作战.
3. godot+python. godot的出现,为我们提供了一个选择,在u3d和ue之外. 曾经godot的一个门槛是gdscript,劝退了一些人. 后来官方支持了c#,已经很优秀了. 不过我决定支持一下python,给开发者再多一个选项,岂不美哉. (在任何时候,有得选,都是一个很正向体验).
4. 这是个独立游戏(此间近邑,名曰小沛,足可屯军).
5. 游戏好玩,是游戏开发的最高准则,立身之本. 然后对技术和美术要有点追求的,虽然现在丑点,不代表以后也要这么丑下去.但凡我有一奈奈的颜色天赋,我都不会让他这么丑着.

玩法系统:
1. [内政](#内政) 扮演太守,治理城市
2. 战争 扮演君主,发动战争
3. 收集培养 扮演君主,招贤纳士,唯才是举
4. 外交
5. 偶然事件
6. 剧情叙事

### 内政
分作几个页签,分别处理各种事务
- 治理: 士农工商,等经济活动,官员任命,官员的参数影响生产
- 任命: 城内武将一览,做一些立即指令,登庸,下野,致仕,训斥,训诫,惩戒,赏赐,巡查,探索,搜索,办学
- 案件: 找一些题库,做选择题.给一点奖励或者惩罚
- 制造: 制造战争物资
- 升迁: 随着我方势力的增强

武将得有行动力,不然一个人能干所有的事情, 行动力缓慢恢复.满值100.

### 战争
- 地图: 即时战斗
- 战法: 就可能是战报了
- 单挑: 战报


地图多大合适,10x10偏小, 20x20差不多,400个块,然后按照0.5的密度,差不多200个城. 但是地图还是不够大.
30*30, 密度0.3, 270个城. 应该就差不多了吧, 但是这个密度其实偏小的.

用像素点来进行城市分布,手工控制密度. 然后用颜色来标记海水,陆地,平原,沙漠.

地块的颜色,是根据周围四
地块的颜色来决定的

### 收集,培养
- 目前的武将数值靠随机,有一些数值看着真是太刺激了
- 发现有潜力的人才,逐步培养成大将

### 外交
- 督邮勒索钱财
- 谴使拜访,增进友好度
- 交易

### 偶然事件
生老病死,遇仙

### 剧情叙事
用一些小的示意图,加文字,串一些故事

<div class="date">2023年3月6日</div>

## 上船了

因为godot4.0上船了,所以接下来的构造内容里面,也要有所体现

1. 包含最新的编辑器,可以打开工程.之前的阶段属于远观,接下来就能亵玩焉
2. 功能验证基本完毕,接下来可以实际接玩法了. 包括: 3D,model,animation,scene,tscn,resource,weekend build,material,shader,ui,font,input,sqlite,lifecycle,memory,gc,coroutine...

Demo.zip包含内容
1. Demo.exe demo的运行程序
2. Demo.pck 资源包
3. GodotEditor 引擎的编辑器
4. game/*.py 游戏脚本,主要内容在此
5. python.exe,python3.dll,python312.zip,sqlite3.dll,_sqlite3.pyd python运行环境

<div class="date">2023年3月6日</div>

## godot engine 4.0 released

今天是个好日子，godot 4.0正式发布了。我这也算是49年起义，与有荣焉。

[Godot 4.0 sets sail: All aboard for new horizons](https://godotengine.org/article/godot-4-0-sets-sail)

翻译翻译，什么叫 godot4.0，扬帆，上船往新世界。所以，我正在一条船上，目前的身份应该是水手，拖鞋沙滩裤，头发有点红。或者说, 应该是小农经济下的猎户.

文章末尾说，Enjoy Godot！
那用godot引擎，做一个三国志9好了。弥补一下三国志9里面的一些不够尽兴的地方，三国志9+。

"吾意已决，今岁必写三国九!"

markdown 用例

横线

------

多级无序号

- aaa
  - aa
  - bb
- bbb
- ccc

多级序号

1. aaa
   1. 111
   2. 222
2. bbb
3. ccc

*斜体*
**粗体**

[内部跳转](#aaa)

<a id="aaa">&nbsp;</a>

表格

| Syntax      | Description |
| ----------- | ----------- |
| Header      | Title       |
| Paragraph   | Text        |

:joy:

引用
> 临江仙
滚滚长江东逝水，浪花淘尽英雄。
是非成败转头空。
青山依旧在，几度夕阳红。
白发渔樵江渚上，惯看秋月春风。
一壶浊酒喜相逢。
古今多少事，都付笑谈中。

<div class="date">2023年3月2日</div>

## 三国志9

在读书的时候，接触到了光荣公司的三国志9，一个跟前作后作完全特立独行的版本。
从此陷入了三国地图的山川河流，城寨关塞里，难以自拔。
我最喜欢的选194年群雄割据的剧本，选择刘备开战。
此时，董卓已死，各路英雄基本还在：吕布还是天下第一，纵横江湖；
袁绍被称作河北，还不叫冢中枯骨；曹操正唯才是举，蠢蠢欲动；
刘备在小沛，虽然十分屌丝，却也艰难地迈出了跟诸侯比一比头铁的脚步；
郭嘉尚在，孔明未出，徐庶还叫单福，是从花果山路砍到南天门街最靓的仔。
诸葛亮14岁，处在青春叛逆期，在荆州依附刘表读书种地，还没有自比管乐，也没准备好光复汉室鞠躬尽瘁。

之所以选择这个时间，就是为了招揽全部英雄。

内政是比较重要的玩法。我挺喜欢种田流的，每天都有收获，种田种的好，名利皆可抛。

战斗，做一些宏观的指令，减少战斗细节的控制。用战损比来描述战斗。


<div class="date">2023年3月2日</div>

## 开始

过年期间，心情烦躁。与其把这些宝贵的时间，花在毫无意义的烦躁上面，不如干点啥。于是，有了这个小工程，学习使人快乐。
此时节，游戏荒，电视荒，连暴雪都自绝于人民了。游戏行业惨淡，女儿成绩飘忽，俄乌局部战争打了一年，土耳其地震，世界是如此的不太平。教人好生意难平。

好烦啊烦，烦啊烦。

<div class="date">2023年3月1日</div>

